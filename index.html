<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>DK数字分身</title>
		<script src="js/vue.js" type="text/javascript" charset="utf-8"></script>
		<link rel="stylesheet" type="text/css" href="./css/litewebchat.css" />
		<!-- 引入样式 -->
		<link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
		<link rel="stylesheet" type="text/css" href="./css/main.css" />
		<!-- 引入组件库 -->
		<script src="https://unpkg.com/element-ui/lib/index.js"></script>
		<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
		<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=0.5, maximum-scale=2.0, user-scalable=yes" />


	</head>
	<body>
		<body>

			<el-container id="app" class="paper">
				<el-header>
				<div class="app-title">DK数字版</div>
				</el-header>
				<el-main>
					<!-- 主容器 -->
					<el-row :span="22">
						<div class="lite-chatbox">

							<div v-for="message in messageList" class="cmsg" v-bind:class="message.direction">

								<img class="headIcon radius" ondragstart="return false;" oncontextmenu="return false;" v-bind:src=message.avatar />
								<span class="name">{{ message.nick }}</span>
								<span class="content">{{ message.msg }}</span>
							</div>
						</div>
					</el-row>

					<div class="inputBox">
						<el-row>
							<el-col :span="18">
								<el-input v-model="inputBox" @keyup.enter.native="send" placeholder="请输入内容"></el-input>
							</el-col>
							 
							<el-col :span="4">
								<el-button @click="send" >发送</el-button>
								<el-col>
						</el-row>
					</div>
				</el-main>
				
			</el-container>
			<el-row><div class="powered"><a href="https://greatdk.com">DK</a>数字分身</div></el-row>
		</body>
		
		<script type="text/javascript">
			var app = new Vue({
				el: '#app',
				data() {
					return {
						messageList: [],
						inputBox: '',
						botNick: 'DK',
						history: [],
						thesaurus: '',
						botAvatar: 'https://cdn.2zimu.com/mbd_file_NDdfNDE1ODM5XzE2ODA0NTAzNTQ1NTRfMTY4MDQ1MDM1NDU1NA.png-webicon',
						myAvatar: 'https://cdn.2zimu.com/mbd_1630305272952_screenshot_1630305272750.jpg-webicon'
					}
			
				},
				methods: {
					// getThesaurus: function() {
					// 	axios.get('https://raw.githubusercontent.com/Kyomotoi/AnimeThesaurus/main/data.json')
					// 		.then((response) => this.thesaurus = response.data)
					// },
					send: function() {
						this.messageList.push({
							nick: '你',
							msg: this.inputBox,
							direction: 'cright',
							avatar: this.myAvatar
						});
						// var words = [],
						// 	reply = '';
						// for (obj in this.thesaurus) {
						// 	if (this.inputBox.indexOf(obj) != -1) {
						// 		words.push(obj);
						// 	}
						// }

						this2 = this
						axios.post('https://service-ei2k47mp-1251731618.bj.apigw.tencentcs.com/release/dk_ai', { text: this.inputBox, history: this.history }, {
							headers: { 'Content-Type': 'application/json' }
							})
							.then(function (response) {
								dk_response = response.data
								console.log(response.data);
								reply = dk_response.response
								this2.history = dk_response.history

								if ( reply == null && this2.history == null) {
									alert("我的祖传V100服务器似乎出了点什么问题，请过段时间再看看")
								}
								else{
									this2.messageList.push({
									nick: this2.botNick,
									msg: reply,
									direction: 'cleft',
									avatar: this2.botAvatar
								});
								setTimeout(() => {
									var div = document.getElementsByClassName('el-main')[0];
									div.scrollTop = div.scrollHeight;
									this2.inputBox = '';
								}, 100)
								}
							})
							.catch(function (error) {
								if (error == 'AxiosError: Request failed with status code 429') {
									alert("不好意思，这个服务跑在一台服务器上，就像一个人一样，处理不了太多消息，所以有一些访问控制，你可以过30秒再发一条试试看")
								}else{
									alert(error)
								}
								console.error(error);
							});
						// if (words.length != 0) {
						// 	word = words[Math.floor(Math.random() * words.length)];
						// 	list = this.thesaurus[word];
						// } else {
						// 	list = ["唔，没有搞懂主人在说什么诶", "没有听懂qwq", "虽然不知道在说什么，但感觉很厉害的样子~", "我是不是太笨啦，没理解主人什么意思qaq"]
						// }
					}
				},
				created: function() {
					// this.getThesaurus();
					this.messageList.push({
						nick: this.botNick,
						msg: '你好，我是由王登科的微信聊天记录，微博及文章作为训练数据，基于 chatglm-6b 训练的一个模型，相较于 chatgpt 这样的模型，我的特点更像是某种对「人」的克隆，因为我的所有来源都是小王这个人所生成的内容（他的回复，他的文章，他的想法）。我并不是他的百科，我也不了解他的所有事情，但是我具备某些和他一样的特点，因为在训练中，他的内容重塑了我的60亿参数',
						direction: 'cleft',
						avatar: this.botAvatar
					});
				}
			});
		</script>
</html>
